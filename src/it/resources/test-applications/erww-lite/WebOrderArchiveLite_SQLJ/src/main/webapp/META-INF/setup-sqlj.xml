<?xml version="1.0" encoding="UTF-8"?>
<project name="WebOrderArchiveLite_SQLJ" default="configureSQLJ" basedir=".">

    <property name="db2.serverName"    value="c-3po.rtp.raleigh.ibm.com"/>
    <property name="db2.portNumber"    value="50001"/>
    <property name="db2.databaseName"  value="ERWW"/>
    <property name="db2.user"          value="db2admin"/>
    <property name="db2.password"      value="db2adminpass"/>
	
	<!-- This directory ougt to contain db2jcc4.jar and sqlj4.jar -->
	<property name="DB2_JARS" value="C:/MaryEllen/DB2_Drivers"/>
    
    <property name="SRC_DIR" value="${basedir}/src"/>
    <property name="WEB_INF" value="${basedir}/WebContent/WEB-INF/classes"/>

    <target name="configureSQLJ">
      <antcall target="help"/>
      <antcall target="transform"/>
      <antcall target="customize.and.bind"/>
    </target>
    
    <target name="help">
    <echo>
    setup-sqlj.xml instructions
    
    This script must be called *before* creating the ERWW application, because the files needed to use SQLJ
    must be generated by this script and packaged into the ERWW application.
    
    Required properties are:
      db2.serverName     The host name of the server that DB2 is running on
      db2.portNumber     The port number from DB2
      db2.databaseName   The name of the DB2 database
      db2.user           The DB2 user name
      db2.password       The password for the DB2 user
      
    These match the properties that are required by a &lt;datasource&gt; element in a server.xml.
    </echo>
    </target>

    <target name="transform">
        <java classname="sqlj.tools.Sqlj" failonerror="true">
          <arg value="-d=${WEB_INF}"/>
          <arg value="-compile=false"/> 
          <arg value="-status"/>
          <arg value="-db2optimize"/>
          <arg value="${SRC_DIR}/sqlj/OrderSQLJImpl.sqlj"/>
          <arg value="${SRC_DIR}/sqlj/OrderlineSQLJImpl.sqlj"/>
          <classpath>
            <pathelement location="${DB2_JARS}/sqlj4.zip"/>
          </classpath>
        </java>
        
        <javac srcdir="${SRC_DIR}" destdir="${WEB_INF}" includeantruntime="false">
          <include name="**/sqlj/**"/>
          <classpath>
            <pathelement location="${DB2_JARS}/sqlj4.zip"/>
            <pathelement location="${DB2_JARS}/db2jcc4.jar"/>
          </classpath>
        </javac>
    </target>
        
    <target name="customize.and.bind">
        <echo message="${WEB_INF}/sqlj/OrderSQLJImpl_SJProfile0.ser"/>
        <java classname="com.ibm.db2.jcc.sqlj.Customizer" failonerror="true" fork="yes">
          <arg value="-url"/>
          <arg value="jdbc:db2://${db2.serverName}:${db2.portNumber}/${db2.databaseName}"/>
          <arg value="-user"/>
          <arg value="${db2.user}"/>
          <arg value="-password"/>
          <arg value="${db2.password}"/>
          <arg value="-rootPkgName"/>
          <arg value="sqlj"/>
          <arg value="OrderSQLJImpl_SJProfile0.ser"/>
          <arg value="OrderlineSQLJImpl_SJProfile0.ser"/>
          <classpath>
            <pathelement location="${WEB_INF}/sqlj"/>
            <pathelement location="${DB2_JARS}/db2jcc4.jar"/>
          </classpath>
        </java>
    </target>
</project>